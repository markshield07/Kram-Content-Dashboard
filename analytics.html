<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - ContentAI</title>
    <style>
        :root {
            --bg-primary: #0d0d0d;
            --bg-secondary: #1a1a1a;
            --bg-card: #141414;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent: #f7931a;
            --accent-hover: #ffa726;
            --border: #2a2a2a;
            --success: #34c759;
            --error: #ff3b30;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .sidebar-logo h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .sidebar-logo h1 span {
            color: var(--accent);
        }

        .nav-section {
            padding: 0 12px;
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-secondary);
            padding: 0 8px;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-item:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: rgba(247, 147, 26, 0.1);
            color: var(--accent);
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
        }

        .top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* Platform Selector */
        .platform-tabs {
            display: flex;
            gap: 8px;
            padding: 20px 30px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .platform-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .platform-tab:hover {
            border-color: var(--accent);
        }

        .platform-tab.active {
            background: rgba(247, 147, 26, 0.1);
            border-color: var(--accent);
            color: var(--accent);
        }

        .platform-tab svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .platform-tab.not-connected {
            opacity: 0.5;
        }

        .platform-tab .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        .platform-tab.not-connected .status-dot {
            background: var(--text-secondary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            padding: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
        }

        .stat-change {
            font-size: 13px;
            margin-top: 8px;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--error);
        }

        /* Content Area */
        .content-area {
            padding: 0 30px 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        /* Top Posts */
        .top-posts {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .post-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }

        .post-item:last-child {
            border-bottom: none;
        }

        .post-item:hover {
            background: var(--bg-secondary);
        }

        .post-rank {
            width: 32px;
            height: 32px;
            background: var(--bg-secondary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--accent);
            flex-shrink: 0;
        }

        .post-content {
            flex: 1;
        }

        .post-text {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .post-metrics {
            display: flex;
            gap: 20px;
        }

        .post-metric {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .post-metric svg {
            width: 16px;
            height: 16px;
        }

        .post-date {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        /* Charts placeholder */
        .chart-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .chart-placeholder {
            height: 250px;
            background: var(--bg-secondary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Best Times */
        .best-times-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .day-column {
            text-align: center;
        }

        .day-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .hour-block {
            height: 24px;
            background: var(--bg-secondary);
            border-radius: 4px;
            margin-bottom: 4px;
        }

        .hour-block.hot {
            background: var(--accent);
        }

        .hour-block.warm {
            background: rgba(247, 147, 26, 0.5);
        }

        .hour-block.mild {
            background: rgba(247, 147, 26, 0.2);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            border: none;
        }

        .btn-primary {
            background: var(--accent);
            color: #000;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .chart-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                padding: 20px;
            }

            .platform-tabs {
                overflow-x: auto;
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-logo">
            <h1>Content<span>AI</span></h1>
        </div>

        <div class="nav-section">
            <a href="/dashboard" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Dashboard
            </a>
            <a href="/analytics" class="nav-item active">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 20V10"></path>
                    <path d="M12 20V4"></path>
                    <path d="M6 20v-6"></path>
                </svg>
                Analytics
            </a>
            <a href="/generate" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2a10 10 0 1 0 10 10H12V2z"></path>
                    <path d="M20 12a8 8 0 0 0-8-8v8h8z"></path>
                </svg>
                Generate Content
            </a>
            <a href="/images" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                Image Generator
            </a>
            <a href="/calendar" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                Calendar
            </a>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Tools</div>
            <a href="/ab-testing" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <polyline points="17 11 19 13 23 9"></polyline>
                </svg>
                A/B Testing
            </a>
            <a href="/trends" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                    <polyline points="17 6 23 6 23 12"></polyline>
                </svg>
                Trends
            </a>
            <a href="/competitors" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                Competitors
            </a>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Account</div>
            <a href="/settings" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
                Settings
            </a>
            <a href="/api/logout" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                Logout
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <header class="top-header">
            <h1 class="page-title">Analytics</h1>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="refreshAnalytics()">Refresh Data</button>
            </div>
        </header>

        <!-- Platform Tabs -->
        <div class="platform-tabs">
            <div class="platform-tab active" onclick="selectPlatform('x')">
                <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                X / Twitter
                <span class="status-dot"></span>
            </div>
            <div class="platform-tab not-connected" onclick="selectPlatform('instagram')">
                <svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                Instagram
                <span class="status-dot"></span>
            </div>
            <div class="platform-tab not-connected" onclick="selectPlatform('facebook')">
                <svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                Facebook
                <span class="status-dot"></span>
            </div>
            <div class="platform-tab not-connected" onclick="selectPlatform('tiktok')">
                <svg viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>
                TikTok
                <span class="status-dot"></span>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-label">Total Followers</div>
                <div class="stat-value" id="totalFollowers">-</div>
                <div class="stat-change positive">+2.4% this week</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Engagement</div>
                <div class="stat-value" id="totalEngagement">-</div>
                <div class="stat-change positive">+5.1% this week</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg. Likes/Post</div>
                <div class="stat-value" id="avgLikes">-</div>
                <div class="stat-change negative">-1.2% this week</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Best Post Time</div>
                <div class="stat-value" id="bestTime">-</div>
                <div class="stat-change">Based on your data</div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Top Posts -->
            <h2 class="section-title">Top Performing Posts</h2>
            <div class="top-posts" id="topPosts">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 20V10"></path>
                        <path d="M12 20V4"></path>
                        <path d="M6 20v-6"></path>
                    </svg>
                    <h3>No analytics data yet</h3>
                    <p>Connect your account and we'll show your top performing content here.</p>
                    <button class="btn btn-primary" onclick="refreshAnalytics()">Load Analytics</button>
                </div>
            </div>

            <!-- Charts -->
            <div class="chart-section">
                <div class="chart-card">
                    <h3 class="section-title">Engagement Over Time</h3>
                    <div class="chart-placeholder">
                        Chart coming soon - Connect your account to see data
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="section-title">Best Times to Post</h3>
                    <div class="best-times-grid">
                        <div class="day-column">
                            <div class="day-label">Mon</div>
                            <div class="hour-block"></div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block hot"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block"></div>
                        </div>
                        <div class="day-column">
                            <div class="day-label">Tue</div>
                            <div class="hour-block"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block hot"></div>
                            <div class="hour-block hot"></div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block"></div>
                        </div>
                        <div class="day-column">
                            <div class="day-label">Wed</div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block hot"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block"></div>
                        </div>
                        <div class="day-column">
                            <div class="day-label">Thu</div>
                            <div class="hour-block"></div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block hot"></div>
                            <div class="hour-block hot"></div>
                            <div class="hour-block warm"></div>
                        </div>
                        <div class="day-column">
                            <div class="day-label">Fri</div>
                            <div class="hour-block"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block hot"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block"></div>
                        </div>
                        <div class="day-column">
                            <div class="day-label">Sat</div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block"></div>
                        </div>
                        <div class="day-column">
                            <div class="day-label">Sun</div>
                            <div class="hour-block"></div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block warm"></div>
                            <div class="hour-block mild"></div>
                            <div class="hour-block"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentPlatform = 'x';

        function selectPlatform(platform) {
            currentPlatform = platform;
            document.querySelectorAll('.platform-tab').forEach(tab => tab.classList.remove('active'));
            event.currentTarget.classList.add('active');

            if (event.currentTarget.classList.contains('not-connected')) {
                alert('This platform is not connected yet. Go to Settings to connect your account.');
                return;
            }

            refreshAnalytics();
        }

        async function refreshAnalytics() {
            const topPosts = document.getElementById('topPosts');
            topPosts.innerHTML = '<div class="post-item" style="justify-content: center; color: var(--text-secondary);">Loading analytics...</div>';

            try {
                // Fetch profile and tweets in parallel
                const [tweetsRes, profileRes] = await Promise.all([
                    fetch('/api/tweets?max_results=50'),
                    fetch('/api/profile')
                ]);

                if (tweetsRes.status === 401) {
                    topPosts.innerHTML = `
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 20V10"></path>
                                <path d="M12 20V4"></path>
                                <path d="M6 20v-6"></path>
                            </svg>
                            <h3>Not signed in</h3>
                            <p>Sign in with X to view your analytics.</p>
                            <a href="/api/login" class="btn btn-primary">Sign In</a>
                        </div>
                    `;
                    return;
                }

                if (!tweetsRes.ok) throw new Error('Failed to load');

                const data = await tweetsRes.json();

                // Update profile stats
                if (profileRes.ok) {
                    const profile = await profileRes.json();
                    const metrics = profile.metrics || {};
                    document.getElementById('totalFollowers').textContent =
                        (metrics.followers_count || 0).toLocaleString();
                }

                // Update tweet stats
                document.getElementById('totalEngagement').textContent =
                    (data.summary.total_likes + data.summary.total_retweets).toLocaleString();
                document.getElementById('avgLikes').textContent =
                    data.summary.avg_likes.toFixed(1);

                // Calculate best posting time from tweets
                if (data.tweets.length > 0) {
                    const hours = {};
                    data.tweets.forEach(t => {
                        const hour = new Date(t.created_at).getHours();
                        if (!hours[hour]) hours[hour] = { total: 0, count: 0 };
                        hours[hour].total += t.engagement_score;
                        hours[hour].count++;
                    });
                    let bestHour = 9;
                    let bestAvg = 0;
                    Object.entries(hours).forEach(([h, v]) => {
                        const avg = v.total / v.count;
                        if (avg > bestAvg) { bestAvg = avg; bestHour = parseInt(h); }
                    });
                    const ampm = bestHour >= 12 ? 'PM' : 'AM';
                    const displayHour = bestHour > 12 ? bestHour - 12 : (bestHour === 0 ? 12 : bestHour);
                    document.getElementById('bestTime').textContent = `${displayHour} ${ampm}`;
                }

                // Render top posts
                if (data.tweets.length === 0) {
                    topPosts.innerHTML = `
                        <div class="empty-state">
                            <h3>No posts found</h3>
                            <p>Start posting to see your analytics here.</p>
                        </div>
                    `;
                    return;
                }

                topPosts.innerHTML = data.tweets.slice(0, 10).map((tweet, i) => `
                    <div class="post-item">
                        <div class="post-rank">${i + 1}</div>
                        <div class="post-content">
                            <div class="post-text">${tweet.text}</div>
                            <div class="post-metrics">
                                <span class="post-metric">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                    </svg>
                                    ${tweet.metrics.like_count}
                                </span>
                                <span class="post-metric">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                        <path d="M17 1l4 4-4 4"></path>
                                        <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                                        <path d="M7 23l-4-4 4-4"></path>
                                        <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                                    </svg>
                                    ${tweet.metrics.retweet_count}
                                </span>
                                <span class="post-metric">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                    ${tweet.metrics.reply_count}
                                </span>
                            </div>
                        </div>
                        <div class="post-date">${new Date(tweet.created_at).toLocaleDateString()}</div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error:', error);
                topPosts.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading analytics</h3>
                        <p>Please try again later.</p>
                        <button class="btn btn-primary" onclick="refreshAnalytics()">Retry</button>
                    </div>
                `;
            }
        }

        // Load analytics on page load
        document.addEventListener('DOMContentLoaded', refreshAnalytics);
    </script>
</body>
</html>
